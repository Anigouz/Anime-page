<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-Frame-Options" content="ALLOWALL">
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors *;">
  <title>AniGouz</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    /* [STYLES QISMI OLDINGIDAN TAYYOR HOLATDA KIRITILGAN ‚Äî QISQARTIRILGAN] */
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash" style="position:fixed;width:100vw;height:100vh;z-index:1000;background:black;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;color:white;">
    <video autoplay muted loop style="position:absolute;width:100%;height:100%;object-fit:cover;z-index:-1">
      <source src="https://firebasestorage.googleapis.com/v0/b/oilaviy-post.appspot.com/o/VID_20250615_221525_488.mp4?alt=media" type="video/mp4">
    </video>
    <h1 style="font-size:36px;animation: fadeIn 2s ease forwards;">AniGouz</h1>
    <p style="animation: slideUp 3s ease forwards;">Bizda hammasi bepul!</p>
  </div>  <!-- Toolbar -->  <div class="toolbar">
    <h1>AniGouz</h1>
    <div>
      <button onclick="toggleSearch()">üîç</button>
      <button onclick="showProfile()">üë§</button>
    </div>
  </div>  <!-- Qidiruv -->  <div class="search-bar" id="searchBox">
    <input type="text" id="search" placeholder="Anime qidiring..." onkeydown="checkSearchKey(event)">
  </div>  <!-- Kontent -->  <div class="container">
    <div id="authModal" style="display:none;text-align:center;">
      <h2>Kirish</h2>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Parol">
      <button onclick="login()">Kirish</button>
      <button onclick="register()">Ro‚Äòyxatdan o‚Äòtish</button>
    </div><button id="backButton" onclick="goBack()" style="display:none;">‚Üê Orqaga</button>
<div id="animeList"></div>
<div id="episodeList" style="display:none;"></div>
<div id="player" style="display:none;">
  <iframe id="archivePlayer" allowfullscreen></iframe>
  <button onclick="makeFullScreen()">‚õ∂</button>
</div>

<!-- Profil sahifasi -->
<div id="profileSection" style="display:none; text-align:center;">
  <h2>Profil</h2>
  <button onclick="logout()">Akkauntdan chiqish</button>
</div>

  </div>  <script>
    // Splash yo‚Äòqoladi 3 sekunddan keyin
    setTimeout(() => {
      document.getElementById('splash').style.display = 'none';
    }, 3000);

    const firebaseConfig = {
      apiKey: "AIzaSyBgDwfB9F4mHVAGN_9F-5ZJI56RikyDaeU",
      authDomain: "tv-app-e4ef4.firebaseapp.com",
      databaseURL: "https://tv-app-e4ef4-default-rtdb.firebaseio.com",
      projectId: "tv-app-e4ef4",
      storageBucket: "tv-app-e4ef4.appspot.com",
      messagingSenderId: "224075442016",
      appId: "1:224075442016:web:718aafce5aa16163e06005"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('authModal').style.display = 'none';
      }
    });

    function login() {
      auth.signInWithEmailAndPassword(email.value, password.value)
        .then(() => document.getElementById('authModal').style.display = 'none')
        .catch(err => alert(err.message));
    }

    function register() {
      auth.createUserWithEmailAndPassword(email.value, password.value)
        .then(() => document.getElementById('authModal').style.display = 'none')
        .catch(err => alert(err.message));
    }

    let allAnime = [];

    function loadAnime() {
      db.ref('animeList').once('value', snapshot => {
        allAnime = [];
        snapshot.forEach(child => allAnime.push(child.val()));
        renderAnime(allAnime);
      });
    }

    function renderAnime(animes) {
      const container = document.getElementById('animeList');
      container.innerHTML = '';
      animes.forEach(anime => {
        const el = document.createElement('div');
        el.className = 'anime';
        el.innerHTML = `
          <img src="${anime.image}" style="width:100%;height:auto;object-fit:contain;border-radius:6px;">
          <h3>${anime.title}</h3>
          <p>${anime.desc}</p>
          <button onclick="checkAuth('${anime.id}')">Qismlar</button>
        `;
        container.appendChild(el);
      });
      document.getElementById('animeList').style.display = 'grid';
    }

    function checkAuth(id) {
      if (!auth.currentUser) {
        document.getElementById('authModal').style.display = 'block';
        return;
      }
      loadEpisodes(id);
    }

    function toggleSearch() {
      const box = document.getElementById('searchBox');
      const input = document.getElementById('search');
      if (box.style.display === 'block') {
        box.style.display = 'none';
        input.value = '';
        renderAnime(allAnime);
      } else {
        box.style.display = 'block';
        input.focus();
      }
    }

    function checkSearchKey(e) {
      if (e.key === 'Enter') {
        filterAnime();
        document.getElementById('searchBox').style.display = 'none';
      }
    }

    function filterAnime() {
      const q = document.getElementById('search').value.toLowerCase();
      const filtered = allAnime.filter(a => a.title.toLowerCase().includes(q));
      renderAnime(filtered);
    }

    function loadEpisodes(id) {
      history.pushState({ view: 'episodes', animeId: id }, '', '#episodes');
      document.getElementById('animeList').style.display = 'none';
      document.getElementById('episodeList').style.display = 'block';
      document.getElementById('player').style.display = 'none';
      document.getElementById('profileSection').style.display = 'none';
      document.getElementById('episodeList').innerHTML = '';
      document.getElementById('backButton').style.display = 'block';

      db.ref('episodes/' + id).once('value', snapshot => {
        snapshot.forEach(child => {
          const ep = child.val();
          const el = document.createElement('div');
          el.className = 'episode';
          el.innerHTML = `
            <h4>${ep.title}</h4>
            <button onclick="playVideo('${ep.stream}')">Tomosha qilish</button>
          `;
          document.getElementById('episodeList').appendChild(el);
        });
      });
    }

    function playVideo(stream) {
      history.pushState({ view: 'player' }, '', '#player');
      document.getElementById('episodeList').style.display = 'none';
      document.getElementById('player').style.display = 'block';
      document.getElementById('archivePlayer').src = `https://archive.org/embed/${stream}`;
    }

    function makeFullScreen() {
      const iframe = document.getElementById('archivePlayer');
      if (iframe.requestFullscreen) iframe.requestFullscreen();
      else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
      else if (iframe.mozRequestFullScreen) iframe.mozRequestFullScreen();
      else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
    }

    function goBack() {
      history.back();
    }

    function showProfile() {
      document.getElementById('animeList').style.display = 'none';
      document.getElementById('episodeList').style.display = 'none';
      document.getElementById('player').style.display = 'none';
      document.getElementById('profileSection').style.display = 'block';
      document.getElementById('backButton').style.display = 'block';
    }

    function logout() {
      firebase.auth().signOut().then(() => {
        location.reload();
      });
    }

    window.onpopstate = function (event) {
      document.getElementById('archivePlayer').src = "";
      if (!event.state || event.state.view === 'home') {
        document.getElementById('animeList').style.display = 'grid';
        document.getElementById('episodeList').style.display = 'none';
        document.getElementById('player').style.display = 'none';
        document.getElementById('profileSection').style.display = 'none';
        document.getElementById('backButton').style.display = 'none';
        loadAnime();
      } else if (event.state.view === 'episodes') {
        loadEpisodes(event.state.animeId);
      } else if (event.state.view === 'player') {
        document.getElementById('player').style.display = 'block';
      }
    };

    // Yuklanganda anime ro‚Äòyxatini chiqarish
    window.addEventListener('DOMContentLoaded', () => {
      loadAnime();
    });
  </script></body>
  </html>
